{"version":3,"sources":["zombie/scene/system/input.cljs"],"mappings":"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","names":["zombie.scene.system.input/v1","js/module$node_modules$three$build$three_module.Vector3","zombie.scene.system.input/v2","zombie.scene.system.input/r1","js/module$node_modules$three$build$three_module.Ray","zombie.scene.system.input/ground-plane","js/module$node_modules$three$build$three_module.Plane","zombie.scene.system.input/mouse-button->action","zombie.scene.system.input/keycode->axis","zombie.scene.system.input/pick-at-position","raycaster","camera","pickables","position","cljs.core/clj->js","temp__5753__auto__","i","cljs.core/first","p__10864","map__10865","cljs.core/--destructure-map","cljs.core.get","zombie.scene.system.input/normalized->world-position","x","y","origin","dir","ray","dist","zombie.util.input/point->map","zombie.scene.system.input/get-click-handler","local-state","obj","cljs.core/deref","cljs.core.get_in","zombie.scene.system.input/set-cursor!","canvas","type","zombie.scene.system.input/get-cursor-type","zombie.scene.system.input/on-mouse-move","_local-state","evt","screen-pos","zombie.util.input/mouse-evt->canvas-position","cljs.core.swap_BANG_","zombie.state.databases/input","cljs.core/assoc-in","zombie.scene.system.input/try-click-at-position","normalized-pos","map__10878","vec__10879","cljs.core.nth","pick-camera","picked-obj","point","click-handler","G__10882","zombie.scene.system.input/on-mouse-down","bus","cljs.core._EQ_","norm-pos","zombie.util.input/normalize-screen-position","action-type","zombie.util.messaging/send","zombie.scene.system.input/on-mouse-up","_canvas","zombie.scene.system.input/sum-axis","axis-entries","cljs.core.reduce","p__10883","p__10884","vec__10885","vec__10888","ax","ay","zombie.scene.system.input/inc-axis!","axis-type","axis","acc","cljs.core.conj","zombie.scene.system.input/dec-axis!","cljs.core.disj","zombie.scene.system.input/on-key-down","key-code","vec__10891","zombie.scene.system.input/on-key-up","vec__10894","zombie.scene.system.input/add-listeners!","handler-map","cljs.core.partial","cljs.core/assoc","seq__10899","cljs.core/seq","chunk__10900","count__10901","i__10902","vec__10913","cljs.core/chunked-seq?","c__4638__auto__","cljs.core/chunk-first","cljs.core/chunk-rest","cljs.core/count","vec__10920","cljs.core/next","event-name","handler-fn","zombie.scene.system.input/remove-listeners!","handlers","seq__10929","chunk__10930","count__10931","i__10932","vec__10945","vec__10948","cljs.core/dissoc","zombie.scene.system.input/tick","map__10951","world-pos","temp__5751__auto__","vec__10952","_","this__4461__auto__","k__4462__auto__","this__4463__auto__","k10968","else__4464__auto__","G__10972","cljs.core/Keyword","event-bus","__extmap","this__4481__auto__","f__4482__auto__","init__4483__auto__","ret__4484__auto__","p__10973","vec__10974","k__4485__auto__","v__4486__auto__","cljs.core/PROTOCOL_SENTINEL","p__10977","map__10978","p__10979","map__10980","p__10981","map__10982","this__4476__auto__","writer__4477__auto__","opts__4478__auto__","pr-pair__4479__auto__","keyval__4480__auto__","cljs.core/pr-sequential-writer","cljs.core.concat","cljs.core/PersistentVector","G__10967","cljs.core/RecordIter","cljs.core/-iterator","cljs.core/nil-iter","this__4459__auto__","__meta","this__4456__auto__","__hash","this__4465__auto__","this__4457__auto__","h__4319__auto__","coll__4458__auto__","cljs.core/hash-unordered-coll","this10969","other10970","this__4471__auto__","k__4472__auto__","cljs.core/contains?","cljs.core.dissoc","cljs.core/-with-meta","cljs.core.into","cljs.core/not-empty","this__4468__auto__","G__10983","this__4469__auto__","k__4470__auto__","pred__10984","cljs.core/keyword-identical?","expr__10985","cljs.core.assoc","this__4474__auto__","cljs.core/MapEntry","this__4460__auto__","this__4466__auto__","entry__4467__auto__","cljs.core/vector?","cljs.core/-nth","cljs.core/-conj","zombie.scene.system.input/InputSystem","this__4505__auto__","cljs.core/List","writer__4506__auto__","cljs.core/-write","G__10971","extmap__4501__auto__","G__10987","cljs.core/record?","zombie.scene.system.input/->InputSystem","zombie.scene.system.input/map->InputSystem","threejs-scene","js/module$node_modules$three$build$three_module.Raycaster","key","receive-events?","cursor","on-click","cljs.core/update","cljs.core/conj","_config","cljs.core/disj","_delta-time","zombie.scene.system.input/create","cljs.core.atom"],"sourcesContent":["(ns zombie.scene.system.input\r\n  (:require [threeagent.system :refer [ISystem]]\r\n            [\"three\" :as three]\r\n            [zombie.util.input :refer [mouse-evt->canvas-position\r\n                                     normalize-screen-position\r\n                                     point->map]]\r\n            [zombie.util.messaging :as message]\r\n            [zombie.state.databases :as db]))\r\n\r\n(def ^:private v1 (three/Vector3.))\r\n(def ^:private v2 (three/Vector3.))\r\n(def ^:private r1 (three/Ray.))\r\n(def ^:private ground-plane (three/Plane. (three/Vector3. 0 1 0)))\r\n\r\n(def ^:private mouse-button->action {0 :fire\r\n                                     2 :aim})\r\n\r\n(def ^:private keycode->axis {65 [:move [-1 0]]\r\n                              68 [:move [1 0]]\r\n                              87 [:move [0 1]]\r\n                              83 [:move [0 -1]]})\r\n\r\n(defn- pick-at-position [^three/Raycaster raycaster\r\n                         ^three/Camera camera\r\n                         pickables\r\n                         position]\r\n  (.setFromCamera raycaster (clj->js position) camera)\r\n  (when-let [i (first (.intersectObjects raycaster (clj->js pickables) true))]\r\n    [(.-object i) (.-point i)]))\r\n\r\n(defn- normalized->world-position [^three/Camera camera {:keys [x y]}]\r\n  ;; WARNING: This assumes ortho cam\r\n  (let [origin (-> v1\r\n                   (.set x y -1)\r\n                   (.unproject camera))\r\n        dir (.getWorldDirection camera v2)\r\n        ray (.set r1 origin dir)\r\n        dist (.distanceToPlane ray ground-plane)]\r\n    (.at ray dist v2)\r\n    (point->map v2)))\r\n\r\n(defn- get-click-handler [local-state obj]\r\n  (get-in @local-state [:on-click obj]))\r\n\r\n(defn- set-cursor! [canvas type]\r\n  (set! (.-cursor (.-style canvas)) type))\r\n\r\n(defn- get-cursor-type [local-state obj]\r\n  (get-in @local-state [:cursor obj] \"default\"))\r\n               \r\n(defn- on-mouse-move [_local-state canvas evt]\r\n  (let [screen-pos (mouse-evt->canvas-position canvas evt)]\r\n    (swap! db/input assoc-in [:mouse :screen-position] screen-pos)))\r\n\r\n(defn- try-click-at-position [local-state normalized-pos]\r\n  (let [{:keys [raycaster\r\n                pickables\r\n                pick-camera]} @local-state\r\n        [picked-obj point] (pick-at-position raycaster pick-camera pickables normalized-pos)]\r\n    (when picked-obj\r\n      (when-let [click-handler (get-click-handler local-state picked-obj)]\r\n        (click-handler (point->map point))))))\r\n\r\n(defn- on-mouse-down [bus local-state canvas evt]\r\n  (when (= 0 (.-button evt))\r\n    (when-let [screen-pos (get-in @db/input [:mouse :screen-position])]\r\n      (let [norm-pos (normalize-screen-position canvas screen-pos)]\r\n        (try-click-at-position local-state norm-pos))))\r\n  (when-let [action-type (get mouse-button->action (.-button evt))]\r\n    (message/send bus\r\n                  (:receiving-entities @local-state)\r\n                  [:input/action action-type] true)))\r\n\r\n(defn- on-mouse-up [bus local-state _canvas evt]\r\n  (when-let [action-type (get mouse-button->action (.-button evt))]\r\n    (message/send bus\r\n                  (:receiving-entities @local-state)\r\n                  [:input/action action-type] false)))\r\n\r\n(defn- sum-axis [axis-entries]\r\n   (->> axis-entries\r\n        (reduce (fn [[ax ay] [x y]]\r\n                  [(+ ax x)\r\n                   (+ ay y)])\r\n                [0 0])))\r\n(defn- inc-axis! [local-state axis-type axis]\r\n  (let [acc (conj (get-in @local-state [:axis axis-type] #{})\r\n                  axis)]\r\n    (swap! local-state assoc-in [:axis axis-type] acc)\r\n    (sum-axis acc)))\r\n\r\n(defn- dec-axis! [local-state axis-type axis]\r\n  (let [acc (disj (get-in @local-state [:axis axis-type] #{})\r\n                  axis)]\r\n    (swap! local-state assoc-in [:axis axis-type] acc)\r\n    (sum-axis acc)))\r\n  \r\n(defn- on-key-down [bus local-state _canvas evt]\r\n  ;;(js/console.log (.-keyCode evt))\r\n  (let [key-code (.-keyCode evt)]\r\n    (when-let [[type axis] (get keycode->axis key-code)]\r\n      (when-not (get-in @local-state [:keys key-code])\r\n        (swap! local-state assoc-in [:keys key-code] true)\r\n        (message/send bus\r\n                      (:receiving-entities @local-state)\r\n                      [:input/axis-update type] (inc-axis! local-state type axis))))))\r\n\r\n(defn- on-key-up [bus local-state _canvas evt]\r\n  (when-let [[type axis] (get keycode->axis (.-keyCode evt))]\r\n    (swap! local-state assoc-in [:keys (.-keyCode evt)] false)\r\n    (message/send bus\r\n                  (:receiving-entities @local-state)\r\n                  [:input/axis-update type] (dec-axis! local-state type axis))))\r\n\r\n(defn- add-listeners! [bus local-state ^js canvas]\r\n  (let [handler-map {\"mousemove\" (partial on-mouse-move local-state canvas)\r\n                     \"mousedown\" (partial on-mouse-down bus local-state canvas)\r\n                     \"mouseup\" (partial on-mouse-up bus local-state canvas)\r\n                     \"keydown\" (partial on-key-down bus local-state canvas)\r\n                     \"keyup\" (partial on-key-up bus local-state canvas)\r\n                     \"contextmenu\" (fn [evt]\r\n                                     (.preventDefault evt)\r\n                                     false)}]\r\n    (swap! local-state assoc :handlers handler-map)\r\n    (doseq [[event-name handler-fn] handler-map]\r\n      (.addEventListener canvas event-name handler-fn))))\r\n\r\n(defn- remove-listeners! [local-state ^js canvas]\r\n  (when-let [handlers (:handlers @local-state)]\r\n    (doseq [[event-name handler-fn] handlers]\r\n      (.removeEventListener canvas event-name handler-fn))\r\n    (swap! local-state dissoc :handlers)))\r\n\r\n(defn- tick [local-state]\r\n  (when-let [screen-pos (get-in @db/input [:mouse :screen-position])]\r\n    (let [{:keys [raycaster pick-camera pickables canvas]} @local-state\r\n          norm-pos (normalize-screen-position canvas screen-pos)\r\n          world-pos (normalized->world-position pick-camera norm-pos)]\r\n      (swap! db/input assoc-in [:mouse :world-position] world-pos)\r\n      (if-let [[picked-obj _] (pick-at-position raycaster pick-camera pickables norm-pos)]\r\n        (set-cursor! canvas (get-cursor-type local-state picked-obj))\r\n        (set-cursor! canvas \"default\")))))\r\n\r\n(defrecord InputSystem [event-bus local-state]\r\n  ISystem\r\n  (init [_ {:keys [canvas threejs-scene]}]\r\n    (swap! local-state assoc\r\n           :scene threejs-scene\r\n           :canvas canvas\r\n           :raycaster (new three/Raycaster)\r\n           :receiving-entities #{})\r\n    (add-listeners! event-bus local-state canvas))\r\n  (destroy [_ {:keys [canvas]}]\r\n    (remove-listeners! local-state canvas))\r\n  (on-entity-added [_ _ key ^js obj {:keys [pick-camera\r\n                                            receive-events?\r\n                                            cursor\r\n                                            on-click]}]\r\n    (when pick-camera\r\n      (swap! local-state assoc :pick-camera obj))\r\n    (when on-click\r\n      (swap! local-state update :pickables conj obj)\r\n      (swap! local-state assoc-in [:on-click obj] on-click))\r\n    (when receive-events?\r\n      (swap! local-state update :receiving-entities conj key))\r\n    (swap! local-state assoc-in [:cursor obj] cursor))\r\n  (on-entity-removed [_ _ key obj _config]\r\n    (swap! local-state update :pickables disj obj)\r\n    (swap! local-state update :receiving-entities disj key))\r\n\r\n  (tick [_ _delta-time]\r\n    (tick local-state)))\r\n\r\n(defn create [event-bus]\r\n  (let [local-state (atom {:pickables #{}})]\r\n    (->InputSystem event-bus local-state)))\r\n\r\n"]}