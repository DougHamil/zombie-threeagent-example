shadow$provide.module$node_modules$three_nebula$build$esm$emitter$Emitter=function(global,require,module,exports){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(){if("function"!==typeof WeakMap)return null;var cache=new WeakMap;_getRequireWildcardCache=function(){return cache};return cache}Object.defineProperty(exports,"__esModule",{value:!0});exports.default=void 0;var _constants=require("module$node_modules$three_nebula$build$esm$emitter$constants"),
_events=function(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==typeof obj&&"function"!==typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor,key;for(key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,
key,desc):newObj[key]=obj[key]}newObj.default=obj;cache&&cache.set(obj,newObj);return newObj}(require("module$node_modules$three_nebula$build$esm$events$index")),_math=require("module$node_modules$three_nebula$build$esm$math$index"),_utils=require("module$node_modules$three_nebula$build$esm$utils$index"),_initializer=require("module$node_modules$three_nebula$build$esm$initializer$index"),_Particle=_interopRequireDefault(require("module$node_modules$three_nebula$build$esm$core$Particle")),_isNumber=
_interopRequireDefault(require("module$node_modules$lodash$isNumber")),_types=require("module$node_modules$three_nebula$build$esm$emitter$types");class Emitter extends _Particle.default{constructor(properties){super(properties);this.type=_types.EMITTER_TYPE_EMITTER;this.particles=[];this.initializers=[];this.behaviours=[];this.emitterBehaviours=[];this.currentEmitTime=0;this.totalEmitTimes=-1;this.damping=_constants.DEFAULT_DAMPING;this.bindEmitter=_constants.DEFAULT_BIND_EMITTER;this.bindEmitterEvent=
_constants.DEFAULT_BIND_EMITTER_EVENT;this.rate=_constants.DEFAULT_EMITTER_RATE;this.isEmitting=!1;this.id=`emitter-${(0,_utils.uid)()}`;this.cID=0;this.name="Emitter";this.index=_constants.DEFAULT_EMITTER_INDEX;this.eventDispatcher=new _events.default}dispatch(event,target=this){this.eventDispatcher.dispatchEvent(event,target)}setRate(rate){this.rate=rate;return this}setPosition(newPosition={}){const {position}=this,{x=position.x,y=position.y,z=position.z}=newPosition;this.position.set(x,y,z);return this}setRotation(newRotation=
{}){const {rotation}=this,{x=rotation.x,y=rotation.y,z=rotation.z}=newRotation;this.rotation.set(x,y,z);return this}emit(totalEmitTimes=Infinity,life=Infinity){this.currentEmitTime=0;this.totalEmitTimes=(0,_isNumber.default)(totalEmitTimes)?totalEmitTimes:Infinity;this.life=1===totalEmitTimes?totalEmitTimes:(0,_isNumber.default)(life)?life:Infinity;this.rate.init();this.isEmitting=!0;return this}experimental_emit(){const {isEmitting,totalEmitTimes,life}=this;isEmitting||(this.currentEmitTime=0,totalEmitTimes||
this.setTotalEmitTimes(Infinity),life||this.setLife(Infinity),this.rate.init(),this.isEmitting=!0);return this}setTotalEmitTimes(totalEmitTimes=Infinity){this.totalEmitTimes=(0,_isNumber.default)(totalEmitTimes)?totalEmitTimes:Infinity;return this}setLife(life=Infinity){this.life=1===this.totalEmitTimes?this.totalEmitTimes:(0,_isNumber.default)(life)?life:Infinity;return this}stopEmit(){this.totalEmitTimes=-1;this.currentEmitTime=0;this.isEmitting=!1}removeAllParticles(){let i=this.particles.length;
for(;i--;)this.particles[i].dead=!0}addInitializer(initializer){this.initializers.push(initializer);return this}addInitializers(initializers){let i=initializers.length;for(;i--;)this.addInitializer(initializers[i]);return this}setInitializers(initializers){this.initializers=initializers;return this}removeInitializer(initializer){initializer=this.initializers.indexOf(initializer);-1<initializer&&this.initializers.splice(initializer,1);return this}removeAllInitializers(){_utils.Util.destroyArray(this.initializers);
return this}addBehaviour(behaviour){this.behaviours.push(behaviour);return this}addBehaviours(behaviours){let i=behaviours.length;for(;i--;)this.addBehaviour(behaviours[i]);return this}setBehaviours(behaviours){this.behaviours=behaviours;return this}removeBehaviour(behaviour){behaviour=this.behaviours.indexOf(behaviour);-1<behaviour&&this.behaviours.splice(behaviour,1);return this}removeAllBehaviours(){_utils.Util.destroyArray(this.behaviours);return this}addEmitterBehaviour(behaviour){this.emitterBehaviours.push(behaviour);
behaviour.initialize(this);return this}addEmitterBehaviours(behaviours){let i=behaviours.length;for(;i--;)this.addEmitterBehaviour(behaviours[i]);return this}setEmitterBehaviours(behaviours){const length=behaviours.length;this.emitterBehaviours=behaviours;for(behaviours=0;behaviours<length;behaviours++)this.emitterBehaviours[behaviours].initialize(this);return this}removeEmitterBehaviour(behaviour){behaviour=this.emitterBehaviours.indexOf(behaviour);-1<behaviour&&this.emitterBehaviours.splice(behaviour,
1);return this}removeAllEmitterBehaviours(){_utils.Util.destroyArray(this.emitterBehaviours);return this}addOnEmitterDeadEventListener(onEmitterDead){this.eventDispatcher.addEventListener(`${this.id}_${_events.EMITTER_DEAD}`,()=>onEmitterDead());return this}createParticle(){const particle=this.parent.pool.get(_Particle.default);this.setupParticle(particle,this.particles.length);this.parent&&this.parent.dispatch(_events.PARTICLE_CREATED,particle);this.bindEmitterEvent&&this.dispatch(_events.PARTICLE_CREATED,
particle);return particle}setupParticle(particle,index){const {initializers,behaviours}=this;_initializer.InitializerUtil.initialize(this,particle,initializers);particle.addBehaviours(behaviours);particle.parent=this;particle.index=index;this.particles.push(particle)}update(time){if(this.isEmitting){this.age+=time;(this.dead||this.age>=this.life)&&this.destroy();this.generate(time);this.integrate(time);for(var i=this.particles.length;i--;){const particle=this.particles[i];particle.dead&&(this.parent&&
this.parent.dispatch(_events.PARTICLE_DEAD,particle),this.bindEmitterEvent&&this.dispatch(_events.PARTICLE_DEAD,particle),this.parent.pool.expire(particle.reset()),this.particles.splice(i,1))}this.updateEmitterBehaviours(time)}}updateEmitterBehaviours(time){if(!this.sleep){var length=this.emitterBehaviours.length;for(let i=0;i<length;i++)this.emitterBehaviours[i].applyBehaviour(this,time,i)}}integrate(time){const integrationType=this.parent?this.parent.integrationType:_math.INTEGRATION_TYPE_EULER,
damping=1-this.damping;(0,_math.integrate)(this,time,damping,integrationType);let index=this.particles.length;for(;index--;){const particle=this.particles[index];particle.update(time,index);(0,_math.integrate)(particle,time,damping,integrationType);this.parent&&this.parent.dispatch(_events.PARTICLE_UPDATE,particle);this.bindEmitterEvent&&this.dispatch(_events.PARTICLE_UPDATE,particle)}}generate(time){if(1===this.totalEmitTimes){time=this.rate.getValue(99999);0<time&&(this.cID=time);for(;time--;)this.createParticle();
this.totalEmitTimes=0}else if(this.currentEmitTime+=time,this.currentEmitTime<this.totalEmitTimes)for(time=this.rate.getValue(time),0<time&&(this.cID=time);time--;)this.createParticle()}destroy(){this.dead=!0;this.energy=0;this.totalEmitTimes=-1;0==this.particles.length&&(this.isEmitting=!1,this.removeAllInitializers(),this.removeAllBehaviours(),this.dispatch(`${this.id}_${_events.EMITTER_DEAD}`),this.parent&&this.parent.removeEmitter(this))}}exports.default=Emitter}
//# sourceMappingURL=module$node_modules$three_nebula$build$esm$emitter$Emitter.js.map
