shadow$provide.module$node_modules$troika_worker_utils$dist$troika_worker_utils_esm=function(global,require,module,exports){function BespokeThenable(){function complete(st,val){completeCalled++;var ignoreThrow=0;try{val===thenableObj&&recursiveError();var valThen=0<st&&getThenableThen(val);valThen?valThen.call(val,oneTime(function(v){ignoreThrow++;complete(1,v)}),oneTime(function(v){ignoreThrow++;complete(-1,v)})):(state=st,value=val,scheduled||(setTimeout(flushQueue,0),scheduled=1))}catch(e){state||
ignoreThrow||complete(-1,e)}}function flushQueue(){var q=queue;scheduled=0;queue=[];q.forEach(callIt)}function callIt(fn){fn()}function getThenableThen(val){val=val&&(isFn(val)||"object"===typeof val)&&val.then;return isFn(val)&&val}function oneTime(fn){var called=0;return function(){for(var args=[],len=arguments.length;len--;)args[len]=arguments[len];called++||fn.apply(this,args)}}function recursiveError(){throw new TypeError("Chaining cycle detected");}var state=0,queue=[],value,scheduled=0,completeCalled=
0,resolve=oneTime(function(val){completeCalled||complete(1,val)}),reject=oneTime(function(reason){completeCalled||complete(-1,reason)}),isFn=function(v){return"function"===typeof v},thenableObj={then:function(onResolve,onReject){var nextThenable=BespokeThenable();queue.push(function(){var cb=0<state?onResolve:onReject;if(isFn(cb))try{var result=cb(value);result===nextThenable&&recursiveError();var resultThen=getThenableThen(result);resultThen?resultThen.call(result,nextThenable.resolve,nextThenable.reject):
nextThenable.resolve(result)}catch(err){nextThenable.reject(err)}else nextThenable[0<state?"resolve":"reject"](value)});state&&!scheduled&&(setTimeout(flushQueue,0),scheduled=1);return nextThenable},resolve,reject};return thenableObj}function NativePromiseThenable(){var resolve,reject,promise=new Promise(function(res,rej){resolve=res;reject=rej});return{then:promise.then.bind(promise),resolve,reject}}function workerBootstrap(){function registerModule(ref,callback){var id=ref.id,name=ref.name,dependencies=
ref.dependencies;void 0===dependencies&&(dependencies=[]);var init=ref.init;void 0===init&&(init=function(){});ref=ref.getTransferables;void 0===ref&&(ref=null);if(!modules[id])try{dependencies=dependencies.map(function(dep){dep&&dep.isWorkerModule&&(registerModule(dep,function(depResult){if(depResult instanceof Error)throw depResult;}),dep=modules[dep.id].value);return dep}),init=rehydrate("\x3c"+name+"\x3e.init",init),ref&&(ref=rehydrate("\x3c"+name+"\x3e.getTransferables",ref)),name=null,"function"===
typeof init?name=init.apply(void 0,dependencies):console.error("worker module init function failed to rehydrate"),modules[id]={id,value:name,getTransferables:ref},callback(name)}catch(err){err&&err.noLog||console.error(err),callback(err)}}function callModule(ref,callback){function handleResult(result){try{var tx=modules[id].getTransferables&&modules[id].getTransferables(result);tx&&Array.isArray(tx)&&tx.length||(tx=void 0);callback(result,tx)}catch(err){console.error(err),callback(err)}}var ref$1,
id=ref.id;ref=ref.args;modules[id]&&"function"===typeof modules[id].value||callback(Error("Worker module "+id+": not found or its 'init' did not return a function"));try{var result$jscomp$0=(ref$1=modules[id]).value.apply(ref$1,ref);result$jscomp$0&&"function"===typeof result$jscomp$0.then?result$jscomp$0.then(handleResult,function(rej){return callback(rej instanceof Error?rej:Error(""+rej))}):handleResult(result$jscomp$0)}catch(err){callback(err)}}function rehydrate(name,str){var result=void 0;self.troikaDefine=
function(r){return result=r};name=URL.createObjectURL(new Blob(["/** "+name.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+str+"\n)"],{type:"application/javascript"}));try{importScripts(name)}catch(err){console.error(err)}URL.revokeObjectURL(name);delete self.troikaDefine;return result}var modules=Object.create(null);self.addEventListener("message",function(e){var ref=e.data,messageId=ref.messageId;e=ref.action;ref=ref.data;try{"registerModule"===e&&registerModule(ref,function(result){result instanceof
Error?postMessage({messageId,success:!1,error:result.message}):postMessage({messageId,success:!0,result:{isCallable:"function"===typeof result}})}),"callModule"===e&&callModule(ref,function(result,transferables){result instanceof Error?postMessage({messageId,success:!1,error:result.message}):postMessage({messageId,success:!0,result},transferables||void 0)})}catch(err){postMessage({messageId,success:!1,error:err.stack})}})}function defineMainThreadModule(options){var moduleFunc=function(){for(var args=
[],len=arguments.length;len--;)args[len]=arguments[len];return moduleFunc._getInitResult().then(function(initResult){if("function"===typeof initResult)return initResult.apply(void 0,args);throw Error("Worker module function was called but `init` did not return a callable function");})};moduleFunc._getInitResult=function(){var dependencies=options.dependencies,init=options.init;dependencies=Array.isArray(dependencies)?dependencies.map(function(dep){return dep&&dep._getInitResult?dep._getInitResult():
dep}):[];var initThenable=DefaultThenable.all(dependencies).then(function(deps){return init.apply(null,deps)});moduleFunc._getInitResult=function(){return initThenable};return initThenable};return moduleFunc}function defineWorkerModule(options){function moduleFunc(){for(var args=[],len=arguments.length;len--;)args[len]=arguments[len];registrationThenable||(registrationThenable=callWorker(workerId,"registerModule",moduleFunc.workerModuleData));return registrationThenable.then(function(ref){if(ref.isCallable)return callWorker(workerId,
"callModule",{id,args});throw Error("Worker module function was called but `init` did not return a callable function");})}if(!(options&&"function"===typeof options.init||_allowInitAsString))throw Error("requires `options.init` function");var dependencies=options.dependencies,init=options.init,getTransferables=options.getTransferables,workerId=options.workerId;if(!supportsWorkers())return defineMainThreadModule(options);null==workerId&&(workerId="#default");var id="workerModule"+ ++_workerModuleId,
name=options.name||id,registrationThenable=null;dependencies=dependencies&&dependencies.map(function(dep){"function"!==typeof dep||dep.workerModuleData||(_allowInitAsString=!0,dep=defineWorkerModule({workerId,name:"\x3c"+name+"\x3e function dependency: "+dep.name,init:"function(){return (\n"+stringifyFunction(dep)+"\n)}"}),_allowInitAsString=!1);dep&&dep.workerModuleData&&(dep=dep.workerModuleData);return dep});moduleFunc.workerModuleData={isWorkerModule:!0,id,name,dependencies,init:stringifyFunction(init),
getTransferables:getTransferables&&stringifyFunction(getTransferables)};return moduleFunc}function stringifyFunction(fn){fn=fn.toString();!/^function/.test(fn)&&/^\w+\s*\(/.test(fn)&&(fn="function "+fn);return fn}function getWorker(workerId){var worker=workers[workerId];worker||(worker=stringifyFunction(workerBootstrap),worker=workers[workerId]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+workerId.replace(/\*/g,"")+" **/\n\n;("+worker+")()"],{type:"application/javascript"}))),
worker.onmessage=function(e){e=e.data;var msgId=e.messageId,callback=openRequests[msgId];if(!callback)throw Error("WorkerModule response with empty or unknown messageId");delete openRequests[msgId];openRequests._count--;callback(e)});return worker}function callWorker(workerId,action,data){var thenable=DefaultThenable(),messageId=++_messageId;openRequests[messageId]=function(response){response.success?thenable.resolve(response.result):thenable.reject(Error("Error in worker "+action+" call: "+response.error))};
openRequests._count++;1E3<openRequests._count&&console.warn("Large number of open WorkerModule requests, some may not be returning");getWorker(workerId).postMessage({messageId,action,data});return thenable}require("module$node_modules$process$browser");"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.defineWorkerModule=defineWorkerModule;exports.stringifyFunction=stringifyFunction;exports.ThenableWorkerModule=exports.Thenable=void 0;BespokeThenable.all=NativePromiseThenable.all=
function(items){var resultCount=0,results=[],out=DefaultThenable();0===items.length?out.resolve([]):items.forEach(function(item,i){var itemThenable=DefaultThenable();itemThenable.resolve(item);itemThenable.then(function(res){resultCount++;results[i]=res;resultCount===items.length&&out.resolve(results)},out.reject)});return out};var DefaultThenable="function"===typeof Promise?NativePromiseThenable:BespokeThenable;exports.Thenable=DefaultThenable;var supportsWorkers=function(){var supported=!1;if("undefined"!==
typeof window&&"undefined"!==typeof window.document)try{(new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})))).terminate(),supported=!0}catch(err){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+err.message+"]")}supportsWorkers=function(){return supported};return supported},_workerModuleId=0,_messageId=0,_allowInitAsString=!1,workers=Object.create(null),openRequests=function(){var obj=Object.create(null);
obj._count=0;return obj}();global=defineWorkerModule({name:"Thenable",dependencies:[DefaultThenable],init:function(Thenable){return Thenable}});exports.ThenableWorkerModule=global}
//# sourceMappingURL=module$node_modules$troika_worker_utils$dist$troika_worker_utils_esm.js.map
