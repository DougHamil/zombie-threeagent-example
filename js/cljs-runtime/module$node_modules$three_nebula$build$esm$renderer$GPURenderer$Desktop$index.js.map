{
"version":3,
"file":"module$node_modules$three_nebula$build$esm$renderer$GPURenderer$Desktop$index.js",
"lineCount":12,
"mappings":"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",
"sources":["node_modules/three-nebula/build/esm/renderer/GPURenderer/Desktop/index.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$three_nebula$build$esm$renderer$GPURenderer$Desktop$index\"] = function(global,require,module,exports) {\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _common = require(\"../common\");\n\nvar _shaders = require(\"./shaders\");\n\nvar _BaseRenderer = _interopRequireDefault(require(\"../../BaseRenderer\"));\n\nvar _constants = require(\"../common/constants\");\n\nvar _core = require(\"../../../core\");\n\nvar _types = require(\"../../types\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n    }\n\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        (0, _defineProperty2.default)(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nlet THREE;\n/**\n * GPURenderer for devices that support floating point textures.\n *\n * @author thrax <manthrax@gmail.com>\n * @author rohan-deshpande <rohan@creativelifeform.com>\n */\n\nclass DesktopGPURenderer extends _BaseRenderer.default {\n  constructor(container, three, options = _constants.DEFAULT_RENDERER_OPTIONS) {\n    super(_types.RENDERER_TYPE_GPU_DESKTOP);\n    THREE = this.three = three;\n\n    const props = _objectSpread(_objectSpread({}, _constants.DEFAULT_RENDERER_OPTIONS), options);\n\n    const {\n      camera,\n      maxParticles,\n      baseColor,\n      blending,\n      depthTest,\n      depthWrite,\n      transparent,\n      shouldDebugTextureAtlas\n    } = props;\n    const particleBuffer = new _common.ParticleBuffer(maxParticles, THREE);\n    const material = new THREE.ShaderMaterial({\n      uniforms: {\n        baseColor: {\n          value: new THREE.Color(baseColor)\n        },\n        uTexture: {\n          value: null\n        },\n        atlasIndex: {\n          value: null\n        }\n      },\n      vertexShader: (0, _shaders.vertexShader)(),\n      fragmentShader: (0, _shaders.fragmentShader)(),\n      blending: THREE[blending],\n      depthTest,\n      depthWrite,\n      transparent\n    });\n    this.container = container;\n    this.camera = camera;\n    this.targetPool = new _core.Pool();\n    this.uniqueList = new _common.UniqueList(maxParticles);\n    this.particleBuffer = particleBuffer;\n    this.buffer = particleBuffer.buffer;\n    this.stride = particleBuffer.stride;\n    this.geometry = particleBuffer.geometry;\n    this.material = material;\n    this.points = new THREE.Points(this.geometry, this.material);\n    this.points.frustumCulled = false;\n    this.shouldDebugTextureAtlas = shouldDebugTextureAtlas;\n    this.container.add(this.points);\n  }\n\n  onSystemUpdate(system) {\n    super.onSystemUpdate(system);\n    this.buffer.needsUpdate = true;\n    this.textureAtlas && this.textureAtlas.update();\n  }\n  /**\n   * Pools the particle target if it does not exist.\n   * Updates the target and maps particle properties to the point.\n   *\n   * @param {Particle}\n   */\n\n\n  onParticleCreated(particle) {\n    if (!particle.target) {\n      particle.target = this.targetPool.get(_common.Target, THREE);\n      this.uniqueList.add(particle.id);\n    }\n\n    this.updateTarget(particle).mapParticleTargetPropsToPoint(particle);\n  }\n  /**\n   * Maps particle properties to the point if the particle has a target.\n   *\n   * @param {Particle}\n   */\n\n\n  onParticleUpdate(particle) {\n    if (!particle.target) {\n      return;\n    }\n\n    this.updateTarget(particle).mapParticleTargetPropsToPoint(particle);\n  }\n  /**\n   * Resets and clears the particle target.\n   *\n   * @param {Particle}\n   */\n\n\n  onParticleDead(particle) {\n    if (!particle.target) {\n      return;\n    }\n\n    particle.target.reset();\n    this.mapParticleTargetPropsToPoint(particle);\n    particle.target = null;\n  }\n  /**\n   * Maps all mutable properties from the particle to the target.\n   *\n   * @param {Particle}\n   * @return {DesktopGPURenderer}\n   */\n\n\n  updateTarget(particle) {\n    const {\n      position,\n      scale,\n      radius,\n      color,\n      alpha,\n      body,\n      id\n    } = particle;\n    const {\n      r,\n      g,\n      b\n    } = color;\n    particle.target.position.copy(position);\n    particle.target.size = scale * radius;\n    particle.target.color.setRGB(r, g, b);\n    particle.target.alpha = alpha;\n    particle.target.index = this.uniqueList.find(id);\n\n    if (body && body instanceof THREE.Sprite) {\n      const {\n        map\n      } = body.material;\n      particle.target.texture = map;\n      particle.target.textureIndex = this.getTextureID(map, this.shouldDebugTextureAtlas);\n    }\n\n    return this;\n  }\n  /**\n   * Entry point for mapping particle properties to buffer geometry points.\n   *\n   * @param {Particle} particle - The particle containing the properties to map\n   * @return {DesktopGPURenderer}\n   */\n\n\n  mapParticleTargetPropsToPoint(particle) {\n    this.updatePointPosition(particle).updatePointSize(particle).updatePointColor(particle).updatePointAlpha(particle).updatePointTextureIndex(particle);\n    return this;\n  }\n  /**\n   * Updates the point's position according to the particle's target position.\n   *\n   * @param {Particle} particle - The particle containing the target position.\n   * @return {DesktopGPURenderer}\n   */\n\n\n  updatePointPosition(particle) {\n    const attribute = 'position';\n    const {\n      geometry,\n      stride,\n      buffer\n    } = this;\n    const {\n      target\n    } = particle;\n    const {\n      offset\n    } = geometry.attributes[attribute];\n    buffer.array[target.index * stride + offset + 0] = target.position.x;\n    buffer.array[target.index * stride + offset + 1] = target.position.y;\n    buffer.array[target.index * stride + offset + 2] = target.position.z;\n    return this;\n  }\n  /**\n   * Updates the point's size relative to the particle's target scale and radius.\n   *\n   * @param {Particle} particle - The particle containing the target scale.\n   * @return {DesktopGPURenderer}\n   */\n\n\n  updatePointSize(particle) {\n    const attribute = 'size';\n    const {\n      geometry,\n      stride,\n      buffer\n    } = this;\n    const {\n      target\n    } = particle;\n    const {\n      offset\n    } = geometry.attributes[attribute];\n    buffer.array[target.index * stride + offset + 0] = target.size;\n    return this;\n  }\n  /**\n   * Updates the point's color attribute according with the particle's target color.\n   *\n   * @param {Particle} particle - The particle containing the target color and alpha.\n   * @return {DesktopGPURenderer}\n   */\n\n\n  updatePointColor(particle) {\n    const attribute = 'color';\n    const {\n      geometry,\n      stride,\n      buffer\n    } = this;\n    const {\n      target\n    } = particle;\n    const {\n      offset\n    } = geometry.attributes[attribute];\n    buffer.array[target.index * stride + offset + 0] = target.color.r;\n    buffer.array[target.index * stride + offset + 1] = target.color.g;\n    buffer.array[target.index * stride + offset + 2] = target.color.b;\n    return this;\n  }\n  /**\n   * Updates the point alpha attribute with the particle's target alpha.\n   *\n   * @param {Particle} particle - The particle containing the target alpha.\n   * @return {DesktopGPURenderer}\n   */\n\n\n  updatePointAlpha(particle) {\n    const attribute = 'alpha';\n    const {\n      geometry,\n      stride,\n      buffer\n    } = this;\n    const {\n      target\n    } = particle;\n    const {\n      offset\n    } = geometry.attributes[attribute];\n    buffer.array[target.index * stride + offset + 0] = target.alpha;\n    return this;\n  }\n  /**\n   * Updates the point texture attribute with the particle's target texture.\n   *\n   * @param {Particle} particle - The particle containing the target texture.\n   * @return {DesktopGPURenderer}\n   */\n\n\n  updatePointTextureIndex(particle) {\n    const attribute = 'texID';\n    const {\n      geometry,\n      stride,\n      buffer\n    } = this;\n    const {\n      target\n    } = particle;\n    const {\n      offset\n    } = geometry.attributes[attribute];\n    buffer.array[target.index * stride + offset + 0] = target.textureIndex;\n    return this;\n  }\n\n  getTextureID(texture, debug) {\n    if (texture.textureIndex === undefined) {\n      if (!this.textureAtlas) {\n        this.textureAtlas = new _common.TextureAtlas(this, debug);\n      }\n\n      this.textureAtlas.addTexture(texture);\n    }\n\n    return texture.textureIndex;\n  }\n  /**\n   * Tears down the GPURenderer.\n   *\n   * @return void\n   */\n\n\n  destroy() {\n    const {\n      container,\n      points,\n      textureAtlas,\n      uniqueList\n    } = this;\n    container.remove(points);\n    uniqueList.destroy();\n    textureAtlas && textureAtlas.destroy();\n  }\n\n}\n\nexports.default = DesktopGPURenderer;\n};"],
"names":["shadow$provide","global","require","module","exports","_interopRequireDefault","obj","__esModule","default","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty2","getOwnPropertyDescriptors","defineProperties","defineProperty","value","_common","_shaders","_BaseRenderer","_constants","_core","_types","THREE","DesktopGPURenderer","constructor","container","three","options","DEFAULT_RENDERER_OPTIONS","RENDERER_TYPE_GPU_DESKTOP","props","camera","maxParticles","baseColor","blending","depthTest","depthWrite","transparent","shouldDebugTextureAtlas","particleBuffer","ParticleBuffer","material","ShaderMaterial","uniforms","Color","uTexture","atlasIndex","vertexShader","fragmentShader","targetPool","Pool","uniqueList","UniqueList","buffer","stride","geometry","points","Points","frustumCulled","add","onSystemUpdate","system","needsUpdate","textureAtlas","update","onParticleCreated","particle","get","Target","id","updateTarget","mapParticleTargetPropsToPoint","onParticleUpdate","onParticleDead","reset","position","scale","radius","color","alpha","body","r","g","b","copy","size","setRGB","index","find","Sprite","map","texture","textureIndex","getTextureID","updatePointPosition","updatePointSize","updatePointColor","updatePointAlpha","updatePointTextureIndex","offset","attributes","array","x","y","z","debug","undefined","TextureAtlas","addTexture","destroy","remove"]
}
