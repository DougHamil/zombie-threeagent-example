{"version":3,"sources":["zombie/scene/view/game.cljs"],"mappings":"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","names":["zombie.scene.view.game/lights","light-target","zombie.scene.view.game/camera-helpers","temp__5753__auto__","cljs.core/deref","helper","G__10739","G__10740","threeagent.core/cursor","zombie.state.databases/scene","zombie.scene.view.game/camera","aspect","G__10743","G__10744","js/module$node_modules$three$build$three_module.Object3D","height","width","zombie.scene.view.game/box","pos","on-click","selected?","zombie.scene.view.game/cross","color","zombie.util.math/pi2","zombie.scene.view.game/axis-pole","rot","zombie.scene.view.game/axes","zombie.scene.view.game/icons","map__10753","cljs.core/--destructure-map","cljs.core.get","x","y","z","G__10751","G__10752","zombie.state.databases/input","zombie.scene.view.game/entities","entities","zombie.state.databases/entities","iter__4611__auto__","s__10755","cljs.core/LazySeq","cljs.core/seq","cljs.core/chunked-seq?","c__4609__auto__","size__4610__auto__","cljs.core/count","b__10757","cljs.core/chunk-buffer","i__10756","vec__10758","cljs.core/-nth","cljs.core.nth","map__10761","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__10754","cljs.core/chunk-rest","vec__10763","cljs.core/first","map__10766","cljs.core/cons","cljs.core/rest","id","type","cfg","G__10762","cljs.core/Keyword","js/Error","G__10767","zombie.scene.player/render","zombie.scene.view.game/render","zombie.scene.effects/render","zombie.scene.map/render","cljs.core/chunk-first"],"sourcesContent":["(ns zombie.scene.view.game\r\n  \"Component for the gameplay view\"\r\n  (:require [threeagent.core :as th]\r\n            [\"three\" :as three]\r\n            [zombie.util.math :refer [pi2]]\r\n            [zombie.state.databases :as db]\r\n            [zombie.scene.map :as map]\r\n            [zombie.scene.effects :as effects]\r\n            [zombie.scene.player :as player]))\r\n\r\n(defn- lights [light-target]\r\n  [:object\r\n   [:directional-light {:position [1 4 0]\r\n                        :cast-shadow true\r\n                        :shadow {:map-size {:width 2048\r\n                                            :height 2048}\r\n                                 :camera {:left -20\r\n                                          :right 20\r\n                                          :top 20\r\n                                          :bottom -20}}\r\n                        :target light-target\r\n                        :color 0xFFFFFF\r\n                        :intensity 0.05}]])\r\n\r\n(defn- camera-helpers []\r\n  [:object\r\n   (when-let [helper @(th/cursor db/scene [:camera-helper])]\r\n     [:instance {:object helper}])])\r\n\r\n(defn- camera []\r\n  (let [aspect @(th/cursor db/scene [:screen-aspect-ratio])\r\n        light-target (three/Object3D.)\r\n        height  10\r\n        width (* height aspect)]\r\n    [:object\r\n     [:object {:id \"audio-listener\"\r\n               :follow {:entity-id \"player\"\r\n                        :look-at? true\r\n                        :position-offset [1 1 1]}\r\n               :audio {:listener? true}}]\r\n     [:object {:follow {:entity-id \"player\"\r\n                        :position-offset [15 18 15]}}\r\n      [:orthographic-camera {:position [0 0 0]\r\n                             :id \"camera\"\r\n                             :entity {}\r\n                             :camera   {:look-at-target \"player\"}\r\n                             :input    {:pick-camera true}\r\n                             :near     0.001\r\n                             :far      1000\r\n                             :left     (- width)\r\n                             :right    width\r\n                             :top      height\r\n                             :bottom   (- height)}\r\n       [:object {:position [0 10 20]}\r\n        [lights light-target]]\r\n       [:object {:position [10 0 -50]}\r\n        [:instance {:object light-target}]]]]]))\r\n\r\n\r\n(defn- box [pos on-click selected?]\r\n  [:object {:physics {:parts {:hull {:type :rectangle\r\n                                     :width 1\r\n                                     :height 1\r\n                                     :settings {:mass 1\r\n                                                :frictionAir 0.5}}}\r\n                      :position-offset [0.5 0 0.5]}\r\n            :position pos}\r\n    [:box {:material {:color (if selected? \"purple\" \"white\")}\r\n           :receive-shadow true\r\n           :cast-shadow true\r\n           :input {:on-click on-click\r\n                   :cursor \"pointer\"}}]])\r\n\r\n(defn- cross [color]\r\n   [:object\r\n    [:box {:material {:color color}\r\n           :cast-shadow true\r\n           :receive-shadow true\r\n           :scale [1 0.1 0.2]}]\r\n    [:box {:material {:color color}\r\n           :rotation [0 pi2 0]\r\n           :cast-shadow true\r\n           :receive-shadow true\r\n           :scale [1 0.1 0.2]}]])\r\n\r\n(defn- axis-pole [rot color]\r\n  [:object {:rotation rot}\r\n   [:cylinder {:material {:color color}\r\n               :position [0 2.5 0]\r\n               :height 5\r\n               :radius-top 0.1\r\n               :radius-bottom 0.1}]])\r\n(defn- axes []\r\n  [:object\r\n   [:object \r\n    [axis-pole [0 0 (- pi2)] \"red\"]]\r\n   [:object\r\n    [axis-pole [0 0 0] \"green\"]]\r\n   [:object \r\n    [axis-pole [pi2 0 0] \"blue\"]]])\r\n\r\n(defn- icons []\r\n  [:object\r\n   (when-let [{:keys [x y z]} @(th/cursor db/input [:mouse :world-position])]\r\n     [:object {:position [x y z]}\r\n      [cross \"blue\"]])])\r\n\r\n(defn- entities []\r\n  (let [entities @db/entities]\r\n    [:object\r\n     (for [[id {:keys [type] :as cfg}] entities]\r\n       ^{:key id}\r\n       [:object\r\n        (case type\r\n          :player [player/render id])])]))\r\n\r\n(defn render []\r\n  [:object\r\n   [icons]\r\n   [effects/render]\r\n   [camera-helpers]\r\n   [camera]\r\n   [map/render]\r\n   [entities]])\r\n"]}