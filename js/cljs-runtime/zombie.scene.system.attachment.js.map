{"version":3,"sources":["zombie/scene/system/attachment.cljs"],"mappings":";;AAMA,AAAA;;;;;;;;;AAAA,AAAA,CAAA,AAAA,uFAAAA,vFAASW;;AAAT,CAAA,AAAA,mGAAA,nGAASA,8GAEAI,EAAEA;;AAFX,AAAA,YAAA,RAESA;AAFT,AAAA;;;AAAA,CAAA,AAAA,sGAAA,tGAASJ,iHAGGI,EAAEA;;AAHd,AAAA,YAAA,RAGYA;AAHZ,AAAA;;;AAAA,CAAA,AAAA,8GAAA,2BAAAd,zIAASU,yHAIWI,EAAEA,MAAEC,IAAIC;;AAJ5B,AAAA,IAAAf,aAAAD;IAAAC,iBAAA,AAAAC,4BAAAD;WAAA,AAAAE,4CAAAF,eAAA,lEAIwCgB;aAJxC,AAAAd,4CAAAF,eAAA,pEAI6CiB;qBAJ7C,AAAAf,4CAAAF,eAAA,5EAIoDkB;oBAJpD,AAAAhB,4CAAAF,eAAA,3EAImEmB;AAJnE,AAAA,YAAA,RAIoBN;AAJpB,AAKI,IAAMO,mBAAW,AAAiBC,kCAAcN,IAAIC;AAApD,AACE,AAAMI,qBAAWH;;AACnB,oBAAME;AAAN,AACE,kBAAA,jBAAM,AAAWF;;AADnB;;AAEA,IAAAK,qBAA6BJ;AAA7B,AAAA,oBAAAI;AAAA,AAAA,IAAAC,aAAAD;gBAAA,AAAAE,4CAAAD,WAAA,IAAA,vEAAYE;YAAZ,AAAAD,4CAAAD,WAAA,IAAA,nEAAsBG;AAAtB,AACE,2DAAA,WAAAC,/DAACC,yBAAWjB,WAAIc,UAAUC;AAA1B,AAAiC,yBAAAC,jBAAM,AAAWV;;;AADpD;;;;AATJ,CAAA,AAAA,gHAAA,4BAAAd,5IAASM,2HAWaI,EAAEA,MAAEC,IAAIe;;AAX9B,AAAA,IAAAzB,aAAAD;IAAAC,iBAAA,AAAAH,4BAAAG;aAAA,AAAAF,4CAAAE,eAAA,pEAW2Ca;AAX3C,AAAA,YAAA,RAWsBJ;AAXtB,AAYI,OAAS,AAAUI,qBAAQA;;;AAZ/B,CAAA,AAAA,mGAAA,nGAASR,8GAaAI,EAAEiB;;AAbX,AAAA,YAAA,RAaSjB;AAbT,AAAA;;;AAAA,CAAA,2DAAA,3DAASJ;AAAT,AAAA,AAAA;;;AAAA,CAAA,iEAAA,jEAASA;;AAAT,CAAA,oEAAA,pEAASA;;AAAT,CAAA,yEAAA,WAAAJ,mBAAAC,qBAAAC,5HAASE;AAAT,AAAA,OAAAD,iBAAAF,qBAAA;;;AAAA;;;uDAAA,vDAASI,sHAAkBC,IAAIC;AAA/B,AAAA,YAAAH,gDAA2BE,IAAIC;;;AAAtBH,AAeT,wCAAA,xCAAMsB,wFAAQC;AAAd,AACE,OAACtB,qDAAmBsB,UAAU,6CAAA,7CAACC","names":["cljs.core/PROTOCOL_SENTINEL","p__13070","map__13071","cljs.core/--destructure-map","cljs.core.get","p__13075","map__13076","this__4450__auto__","writer__4451__auto__","opt__4452__auto__","cljs.core/-write","zombie.scene.system.attachment/AttachmentSystem","zombie.scene.system.attachment/->AttachmentSystem","bus","local-state","_","_id","obj","path","object","visible-signal","hidden?","new-parent","zombie.util.threejs/get-in-object","temp__5753__auto__","vec__13072","cljs.core.nth","entity-id","event","p1__13069#","zombie.util.messaging/on","_obj","_delta-time","zombie.scene.system.attachment/create","event-bus","cljs.core.atom"],"sourcesContent":["(ns zombie.scene.system.attachment\r\n  (:require [zombie.util.threejs :refer [get-in-object]]\r\n            [zombie.util.messaging :as message]\r\n            [\"three\" :as three]\r\n            [threeagent.system :refer [ISystem]]))\r\n\r\n(deftype AttachmentSystem [bus local-state]\r\n  ISystem\r\n  (init [_ _])\r\n  (destroy [_ _])\r\n  (on-entity-added [_ _ _id obj {:keys [path object visible-signal hidden?]}]\r\n    (let [new-parent ^three/Object3D (get-in-object obj path)]\r\n      (.add new-parent object))\r\n    (when hidden?\r\n      (set! (.-visible object) false))\r\n    (when-let [[entity-id event] visible-signal]\r\n      (message/on bus entity-id event #(set! (.-visible object) %))))\r\n  (on-entity-removed [_ _ _id _obj {:keys [object]}]\r\n    (.remove (.-parent object) object))\r\n  (tick [_ _delta-time]))\r\n\r\n(defn create [event-bus]\r\n  (->AttachmentSystem event-bus (atom {})))\r\n"]}